<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Log In / Sign Up Form</title>
  <link rel="stylesheet" href="../style/signin.css">
  
  <!-- import Montserrat -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
  
   <!-- JQuery Library -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  
  <!-- Supabase JS library -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

<div class="form">
  
  <!-- Tab headers -->
  <ul class="tab-group">
    <li class="tab active"><a href="#login">Log In</a></li>
    <li class="tab"><a href="#signup">Sign Up</a></li>
  </ul>
  
  <div class="tab-content">
    
    <!-- Log in tab (this one is shown by default) -->
    <div id="login">   
      <h1>TASTEBUDDIN</h1>
      
      <form action="/" method="post">
        <!-- Email input -->
        <div class="field-wrap">
          <label>
            Email Address<span class="req">*</span>
          </label>
          <input type="email" required autocomplete="off"/>
        </div>
        
        <!-- Password input -->
        <div class="field-wrap">
          <label>
            Password<span class="req">*</span>
          </label>
          <input type="password" required autocomplete="off"/>
        </div>
        
        <!-- Forgot password button (doesnt work yet)-->
        <p class="forgot"><a href="#">Forgot Password?</a></p>
        
        <!-- Submit button -->
        <button class="button button-block"/>Log In</button>
        
      </form>
    </div>
    
    <!-- Sign up tab -->
    <div id="signup">   
      <h1>Sign Up for Free</h1>
      
      <form action="/" method="post">
      
        <div class="top-row">
          <div class="field-wrap">
            <label>
              First Name<span class="req">*</span>
            </label>
            <input type="text" required autocomplete="off" />
          </div>
      
          <div class="field-wrap">
            <label>
              Last Name<span class="req">*</span>
            </label>
            <input type="text" required autocomplete="off"/>
          </div>
        </div>

        <div class="field-wrap">
          <label>
            Email Address<span class="req">*</span>
          </label>
          <input type="email" required autocomplete="off"/>
        </div>
        
        <div class="field-wrap">
          <label>
            Set Password<span class="req">*</span>
          </label>
          <input type="password" required autocomplete="off"/>
        </div>
        
        <button type="submit" class="button button-block"/>Get Started</button>
        
      </form>
    </div>
    
  </div> <!-- /tab-content -->
  
</div> <!-- /form -->


<script>
  // Initialize Supabase client
  const SUPABASE_URL = 'https://nxzaxhgyzapnnqcfjxpn.supabase.co';
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im54emF4aGd5emFwbm5xY2ZqeHBuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAxMTQzMTIsImV4cCI6MjA3NTY5MDMxMn0.bzW-RrlsyoZvvfWLh3YpZ0DO7WTKlNwEMSDK1V_3joc';
  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  // Log In process

  // When user clicks submit button (button says "LOG IN")
  document.querySelector('#login form').addEventListener('submit', async (e) => {
    e.preventDefault();

    const email = document.querySelector('#login input[type="email"]').value;
    const password = document.querySelector('#login input[type="password"]').value;

    const { data, error } = await supabase.auth.signInWithPassword({
        email,
        password
    });

    if (error) {
        alert('Login failed: ' + error.message);
    } else {
        // â­ NEW: store UUID locally
        const user = data.user;
        localStorage.setItem("tastebuddin_user_id", user.id);

        // Redirect to swipe page
        window.location.href = "swipey.html";
    }
});


  // Sign Up process

  // When user clicks the submit button (button that says "GET STARTED")
  document.querySelector('#signup form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const email = document.querySelector('#signup input[type="email"]').value;
    const password = document.querySelector('#signup input[type="password"]').value;

    const { data, error } = await supabase.auth.signUp({ email, password });

    if (!error) {
    const user = data.user;

    // store uuid
    localStorage.setItem("tastebuddin_user_id", user.id);

    // send to backend to create profile
    await fetch("http://localhost:5001/users", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            userid: user.id,
            email: email,
            firstname: document.querySelector('#signup input[type="text"]').value,
            lastname: document.querySelector('#signup .top-row input[type="text"]:nth-child(2)').value
        })
    });

    alert("Signup successful!");
}

  });
</script>

<!-- tab switching and label animation -->
<script>
$('.form').find('input, textarea').on('keyup blur focus', function (e) {
  var $this = $(this),
      label = $this.prev('label');

  // when user types into the field
  if (e.type === 'keyup') {
    // If the input is empty, label moves back down
    if ($this.val() === '') {
      label.removeClass('active highlight');
    // If input has text, label stays floated and highlighted
    } else {
      label.addClass('active highlight');
    }

  // when user clicks away
  } else if (e.type === 'blur') {
    // If the field is empty after clickig away, we remove the highlight from around the box
    if ($this.val() === '') {
      label.removeClass('active highlight');
    // If the field has text after clicking away, remove highlight from label
    } else {
      label.removeClass('highlight');
    }

  // when user clicks into the box
  } else if (e.type === 'focus') {
    // if the field is empty, remove highlight
    if ($this.val() === '') {
      label.removeClass('highlight');
    // if the field has text, highlight the label (when users has clicked in the box)
    } else if ($this.val() !== '') {
      label.addClass('highlight');
    }
  }
});

// tab switching
$('.tab a').on('click', function (e) {
  e.preventDefault();
  
  // mark clicked tab as active
  $(this).parent().addClass('active');
  // remove the acive class from other tabs
  $(this).parent().siblings().removeClass('active');
  // set target to the correct tab content (#login or #signup)
  target = $(this).attr('href');
  // hide all content but the correct tab content
  $('.tab-content > div').not(target).hide();
  // fade in the content
  $(target).fadeIn(600);
});
</script>

</body>
</html>
